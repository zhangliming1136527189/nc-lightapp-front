/** * Created by Banana on 2017/6/27 导入导出. */define(    [        'jquery', 'webUploader','gzip'    ], function ($, WebUploader,gzip) {        return {            // 实例化上传附件            upLoader: function (url) {                return WebUploader.create({                    // 不压缩image                    resize: false,                    accept: {                        title: 'EXCEL_file',                        extensions: 'xls',                        mimeTypes: 'file/*'                    },                    // 文件接收服务端。                    server: ctx + url,                    fileSingleSizeLimit: 1048576,                    // 选择文件的按钮。可选。                    auto: true,                    pick: '#import'                });            },            // 渲染内容            renderDom: function (importData) {                var importUrl = ctx + importData.importUrl,                    exportUrl = ctx + importData.exportUrl,                    title = importData.title,                    stateContent = importData.stateContent                ;                if (stateContent.constructor === Array) {                    var len = stateContent.length,                        contentItem,                        str = ''                    ;                    for (var i = 0; i < len; i++) {                        contentItem = stateContent[i];                        str += '<li>' + contentItem + '</li>';                    }                    var stateDom = '<ul class="padding-left-0">' + str + '</ul>';                    dom = '<div id="stateDom" class="state-view u-container-full padding-top-40 padding-left-60 padding-right-50">' +                        '<div class="state-top padding-left-40 padding-bottom-25">' +                        '<h5 class="state-title">' + title + '导入说明</h5>' +                        '<div class="sate-content">' + stateDom + '</div>' +                        '<div class="sate-btn margin-top-20">' +                        '<form  method="post"  action="'+exportUrl+'" ><button type="submit" class="has-underline has-btn">下载' + title + '导入模板</button></form>' +                        '</div>' +                        '</div>' +                        '<div class="state-bottom padding-bottom-20 padding-top-25 padding-left-40">' +                        '<div id="import" class="">导入文件</div>' +                        '<div id="fileState" class="margin-left-20"></div>' +                        '</div>' +                        '</div>' +                        '<div class="u-container-full margin-top-10">' +                        '<div class="file-case u-row margin-left-100 margin-right-60 padding-top-10 padding-left-20">' +                        '<h5>导入情况</h5>' +                        '<div id="fileUploadState"></div>' +                        '</div>' +                        '</div>'+                        '<div class="state-footer"></div>'                } else {                    dom = '<div id="stateDom" class="state-view u-container-full padding-top-40 padding-left-60 padding-right-50">' +                        '<div class="state-top padding-left-40 padding-bottom-25">' +                        '<h5 class="state-title">' + title + '导入说明</h5>' +                        '<div class="sate-content">' + stateContent + '</div>' +                        '<div class="sate-btn margin-top-20">' +                        '<form  method="post"  action="'+exportUrl+'" ><button type="submit" class="has-underline has-btn">下载' + title + '导入模板</button></form>' +                        '</div>' +                        '</div>' +                        '<div class="state-bottom padding-bottom-20 padding-top-25 padding-left-40">' +                        '<div id="import" class="">导入文件</div>' +                        '<div id="fileState" class="margin-left-20"></div>' +                        '</div>' +                        '</div>' +                        '<div class="u-container-full margin-top-10">' +                        '<div class="file-case u-row margin-left-100 margin-right-60 padding-top-10 padding-left-20">' +                        '<h5>导入情况</h5>' +                        '<div id="fileUploadState"></div>' +                        '</div>' +                        '</div>' +                        '<div class="state-footer"></div>'                }                return dom;            },            // 卡片上传附件            uploadFile: function (url) {                var uploader;                uploader = this.upLoader(url);                uploader.on('beforeFileQueued', function (file) {                    $("#fileState").text("文件名称：" + file.name);                    if (file.ext === "xls") {                    } else {                        $('.file-case').show();                        $("#fileUploadState").html('<div class="error-msg">' +                            '导入文件格式有误，请确认是否为.xls文件。' +                            '</div>');                    }                });                // 文件上传过程中创建进度条实时显示。                uploader.on('uploadProgress', function (file, percentage) {                    $("#fileUploadState").html('<div class="info-msg">' +                        '当前文件正在导入... (<span class="error-msg">请勿关闭浏览器！</span>)' +                        '</div>');                });                uploader.on('uploadAccept', function (object, ret) {                    var dom = '';                    // 进行gzip流量解压                    var gziptools = new gzip();                    ret = gziptools.unzip(ret);                    if (ret && ret.success) {                        uploader.reset();                        $('.file-case').show();                        dom = '<div class="success-msg">' +                            ret.data.data +                            '</div>';                        $("#fileState").html('<div class="file-success">' +                            '<i class="success-color iconfont icon-zhengquetianchong"></i>' +                            '<span class="file-success margin-left-10">导入成功</span>' +                            '</div>');                    } else {                        uploader.reset();                        $('.file-case').show();                        dom = '<div class="error-msg">' +                            ret.error.message +                            '</div>';                        $("#fileState").html('<div class="file-success">' +                            '<i class="error-color iconfont icon-cuowu"></i>' +                            '<span class="file-success margin-left-10">导入失败</span>' +                            '</div>');                    }                    $("#fileUploadState").html(dom);                });                // 当文件被加入队列以后触发                uploader.on('fileQueued', function (file) {                    $("#fileState").text("文件名称：" + file.name);                });            }        }    });